var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},frb;(function(n){function w(t){function u(){n.timeManager.update(),n.inputManager.update(),n.pause||(t.update&&t.update(),n.spriteManager.update())}function f(){n.context.fillStyle="#6495ED",n.context.fillRect(0,0,n.graphics.width,n.graphics.height),n.spriteManager.draw(),t.draw&&t.draw()}var r,e;t.canvas?jQuery&&t.canvas instanceof jQuery?(n.context=t.canvas.getContext("2d"),n.graphics=new i(t.canvas.width,t.canvas.height)):(n.context=t.canvas.getContext("2d"),n.graphics=new i(t.canvas.width,t.canvas.height)):document.getElementsByTagName("canvas").length>0?(r=document.getElementsByTagName("canvas").item(0),t.canvas=r,n.context=r.getContext("2d"),n.graphics=new i(r.width,r.height)):(n.graphics=new i(480,320),r=document.createElement("canvas"),r.width=n.graphics.width,r.height=n.graphics.height,e=document.getElementsByTagName("body").item(0),e.appendChild(r),t.canvas=r,n.context=r.getContext("2d")),n.graphics.fps||(n.graphics.fps=60),$&&$(function(){$(t.canvas).mouseenter(function(){n.inputManager.mouse.onCanvas=!0}),$(t.canvas).mouseleave(function(){n.inputManager.mouse.onCanvas=!1}),$(t.canvas).mousemove(function(t){var i=t.pageX-this.offsetLeft,r=t.pageY-this.offsetTop;n.inputManager.mouse.x=i,n.inputManager.mouse.y=r}),$(t.canvas).mousedown(function(t){t.which===1&&(n.inputManager.mouse.leftButton=!0),t.which===3&&(n.inputManager.mouse.rightButton=!0),t.which===2&&(n.inputManager.mouse.middleButton=!0)}),$(t.canvas).mouseup(function(t){t.which===1&&(n.inputManager.mouse.leftButton=!1),t.which===3&&(n.inputManager.mouse.rightButton=!1),t.which===2&&(n.inputManager.mouse.middleButton=!1)}),$(document).keydown(function(t){n.inputManager.keyboard.pressed[t.which]=!0,n.keys.Space===t.which&&t.preventDefault()}),$(document).keyup(function(t){n.inputManager.keyboard.pressed[t.which]=!1})}),function(){if(t.init&&t.init(),Worker){var i=new Worker("frb-thread.js");i.addEventListener("message",function(){u(),f()},!1),i.postMessage(n.graphics)}else setInterval(function(){u(),f()},1e3/n.graphics.fps)}()}var t=function(){function n(){}return n.e=Math.E,n.log10E=.4342945,n.log2E=1.442695,n.pi=Math.PI,n.piOver2=Math.PI/2,n.piOver4=Math.PI/4,n.twoPi=Math.PI*2,n.invert=function(n){return 0-n},n.clamp=function(n,t,i){return n<t?t:n>i?i:n},n.lerp=function(n,t,i){return n+(t-n)*i},n.toDegrees=function(n){return n*57.295779513082323},n.toRadians=function(n){return n*.017453292519943295},n}(),r,y,f,e,o,s,h,c,l,u,a,v,i,p;n.MathHelper=t,r=function(){function n(){this.list=[],this.length=0}return n.prototype.get=function(n){return this.list[n]},n.prototype.contains=function(n){return this.list.indexOf(n)>=0},n.prototype.add=function(n){this.contains(n)||(this.list.push(n),this.length=this.list.length,n.listsBelongingTo||(n.listsBelongingTo=[]),n.listsBelongingTo.push(this))},n.prototype.push=function(n){this.add(n)},n.prototype.pop=function(){if(this.length<=0)throw"no more items to pop";var n=this.get(this.length-1);return this.remove(n),n},n.prototype.remove=function(n){var i=this.list.indexOf(n),t;i>=0&&(this.list.splice(i,1),this.length=this.list.length,n.listsBelongingTo&&(t=n.listsBelongingTo.indexOf(this),t>=0&&n.listsBelongingTo.splice(t,1)))},n.prototype.removeFromAll=function(n){var i,t;if(n.listsBelongingTo)for(i=n.listsBelongingTo.length,t=0;t<i;t++)n.listsBelongingTo[t].remove(n)},n}(),n.AttachableList=r,y=function(){function n(){this.active=new r,this.available=new r}return n.prototype.add=function(n){var t=null;return this.available.length>0&&(t=this.available.pop()),t===null&&(t=n()),this.active.add(t),t},n.prototype.return=function(n){this.active.remove(n),this.available.add(n)},n}(),n.ResourcePool=y,f=function(){function n(){}return n}(),n.TextureCoordinate=f,e=function(){function t(){this.x=0,this.y=0}return t.prototype.start=function(){n.context.save(),n.context.translate(0-this.x+n.graphics.width/2,this.y+n.graphics.height/2)},t.prototype.end=function(){n.context.restore()},t}(),n.Camera=e,o=function(){function n(){this.start=new Date,this.last=new Date,this.secondDifference=0,this.secondDifferenceFromStart=0}return n.prototype.update=function(){var t=this.start.getTime(),i=this.last.getTime();this.last=new Date;var n=this.last.getTime(),r=n-i,u=n-t;this.secondDifference=r/1e3,this.secondDifferenceFromStart=u/1e3},n}(),n.TimeManager=o,s=function(){function n(){this.camera=new e,this.images={},this.sprites=[]}return n.prototype.add=function(n){var i=n,t,r;return n.indexOf("http")<0&&(i="content/"+n,i.indexOf(".")<0&&(i+=".png")),n in this.images?t=this.images[n]:(t=new Image,t.src=i,t.loadEvents=[],t.onload=function(){for(var n=0;n<t.loadEvents.length;n++)t.loadEvents[n]()},this.images[n]=t),r=new v(n,t,0,0),this.sprites.push(r),r},n.prototype.addCircle=function(n){var t=new a(0,0,n);return this.sprites.push(t),t},n.prototype.update=function(){for(var t,n=0;n<this.sprites.length;n++)t=this.sprites[n],t.update()},n.prototype.draw=function(){var n,t;for(this.camera.start(),n=0;n<this.sprites.length;n++)t=this.sprites[n],t.draw();this.camera.end()},n}(),n.SpriteManager=s,h=function(){function i(){this.mouse=new c,this.keyboard=new l}return i.prototype.update=function(){var i=n.spriteManager.camera.x-n.graphics.width/2,r=t.invert(n.spriteManager.camera.y)-n.graphics.height/2;this.mouse.worldX=i+this.mouse.x,this.mouse.worldY=t.invert(r+this.mouse.y)},i}(),n.InputManager=h,c=function(){function n(){this.x=0,this.y=0,this.worldX=0,this.worldY=0,this.leftButton=!1,this.rightButton=!1,this.middleButton=!1,this.onCanvas=!1}return n}(),n.Mouse=c,l=function(){function t(){this.pressed=[],this.chars={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"PauseBreak",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",91:"Windows",93:"RightClick",96:"Num0",97:"Num1",98:"Num2",99:"Num3",100:"Num4",101:"Num5",102:"Num6",103:"Num7",104:"Num8",105:"Num9",106:"Num*",107:"Num+",109:"Num-",110:"Num.",111:"Num/",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",182:"MyComputer",183:"MyCalculator",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}}return t.prototype.keyDown=function(t){return this.pressed[n.keys[t]]===!0},t}(),n.Keyboard=l,u=function(){function t(){this.x=0,this.y=0,this.xVelocity=0,this.yVelocity=0,this.xTarget=0,this.yTarget=0,this.xAcceleration=0,this.yAcceleration=0,this.zRotation=0,this.zRotationAcceleration=0,this.zRotationVelocity=0,this.listsBelongingTo=[]}return t.prototype.update=function(){var t=n.timeManager.secondDifference;this.x+=this.xVelocity*t+this.xAcceleration*t,this.y+=this.yVelocity*t+this.yAcceleration*t,this.xVelocity+=this.xAcceleration*t,this.yVelocity+=this.yAcceleration*t,this.zRotation+=this.zRotationVelocity*t+this.zRotationAcceleration*t,this.zRotationVelocity+=this.zRotationAcceleration*t},t.prototype.draw=function(){},t.prototype.initialize=function(n){this.updatePositionResults(n),n.listsBelongingTo=this.listsBelongingTo,n.removeSelfFromListsBelongingTo=this.removeSelfFromListsBelongingTo},t.prototype.updatePositionResults=function(n){n.x=this.x,n.y=this.y,n.xVelocity=this.xVelocity,n.yVelocity=this.yVelocity,n.xAcceleration=this.xAcceleration,n.yAcceleration=this.yAcceleration,n.zRotation=this.zRotation,n.zRotationAcceleration=this.zRotationAcceleration,n.zRotationVelocity=this.zRotationVelocity},t.prototype.updateControlValues=function(n){this.x=n.x,this.y=n.y,this.xVelocity=n.xVelocity,this.yVelocity=n.yVelocity,this.xAcceleration=n.xAcceleration,this.yAcceleration=n.yAcceleration,this.zRotation=n.zRotation,this.zRotationVelocity=n.zRotationVelocity,this.zRotationAcceleration=n.zRotationAcceleration},t.prototype.removeSelfFromListsBelongingTo=function(){n.attachableList.removeFromAll(this)},t}(),n.PositionedObject=u,a=function(i){function r(n,t,r){i.call(this),this.radius=r,this.width=r*2,this.height=this.width,this.initialize(this),this.x=n,this.y=t,this.alpha=1,this.color="yellow",this.borderColor="red",this.borderWidth=1}return __extends(r,i),r.prototype.draw=function(){n.context.save(),n.context.translate(this.xTarget,this.yTarget),n.context.rotate(this.zRotation),n.context.globalAlpha=this.alpha,n.context.beginPath(),n.context.arc(this.x,this.y,this.radius,0,t.twoPi,!1),n.context.fillStyle=this.color,n.context.fill(),n.context.lineWidth=this.borderWidth,n.context.strokeStyle=this.borderColor,n.context.stroke(),n.context.restore()},r.prototype.update=function(){i.prototype.update.call(this),this.updateControlValues(this),this.updatePositionResults(this),this.xTarget=this.x,this.yTarget=t.invert(this.y),this.alpha=t.clamp(this.alpha,0,1)},r}(u),n.Circle=a,v=function(i){function r(n,t,r,u){i.call(this),this.name=n,this.img=t,this.width=t.width,this.height=t.height,this.initialize(this),this.x=r,this.y=u,this.alpha=1;var f=this;f.width=t.width,f.height=t.height}return __extends(r,i),r.prototype.draw=function(){if(n.context.save(),n.context.translate(this.xTarget,this.yTarget),n.context.rotate(this.zRotation),n.context.globalAlpha=this.alpha,this.textureCoordinate){var r=this.width*this.textureCoordinate.left,u=this.height*this.textureCoordinate.top,t=this.width*this.textureCoordinate.right-r,i=this.height*this.textureCoordinate.bottom-u;n.context.drawImage(this.img,0,0,t,i,t/-2,i/-2,t,i)}else n.context.drawImage(this.img,this.width/-2,this.height/-2);n.context.restore()},r.prototype.update=function(){i.prototype.update.call(this),this.updateControlValues(this),this.updatePositionResults(this),this.xTarget=this.x,this.yTarget=t.invert(this.y),this.alpha=t.clamp(this.alpha,0,1)},r.prototype.addTextureCoordinate=function(n,t,i,r){this.textureCoordinate=new f,this.textureCoordinate.left=n,this.textureCoordinate.right=t,this.textureCoordinate.top=i,this.textureCoordinate.bottom=r},r}(u),n.Sprite=v,i=function(){function n(n,t){this.width=n,this.height=t}return n}(),n.Graphics=i,p=function(){function n(){}return n}(),n.FrbOptions=p,n.pause=!1,n.attachableList=new r,n.spriteManager=new s,n.inputManager=new h,n.timeManager=new o,n.context,n.graphics,n.keys={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,PauseBreak:19,CapsLock:20,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Delete:46,"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Windows:91,RightClick:93,Num0:96,Num1:97,Num2:98,Num3:99,Num4:100,Num5:101,Num6:102,Num7:103,Num8:104,Num9:105,"Num*":106,"Num+":107,"Num-":109,"Num.":110,"Num/":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NumLock:144,ScrollLock:145,MyComputer:182,MyCalculator:183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},n.start=w})(frb||(frb={}))